### Recover

#### 概述

断点恢复功能允许任务在执行失败时，从上次中断的地方继续执行。恢复过程涵盖任务的主要逻辑，以及 `Context` 和 `Resource` 的恢复，以确保任务恢复后的行为与最初执行时一致。

#### 启用断点恢复

默认情况下，断点恢复功能是禁用的。要启用此功能，需要在 `Flow` 上调用 `EnableRecover()` 方法。

```go

```

启用后，当任务执行完毕且发生失败时，框架会生成当前 `Context` 和 `Resource` 的快照，并通过序列化方式保存。任务恢复还要求用户对 `Context` 和 `Resource` 中的**非基本类型进行注册**（`RegisterType`）。

#### 恢复机制

- **快照生成**: 当可恢复任务执行失败时，框架会生成 `Context` 和 `Resource` 的快照，并通过 gob 序列化后，调用用户提供的持久化接口进行保存。
- **任务恢复**: 任务失败后，框架会挂起任务并记录失败点。在恢复时，框架会重新加载保存的 `Context` 和 `Resource` 快照，从失败的 `Step` 或前置 `Callback` 继续执行。恢复过程中，后置 `Callback` 也会被重新执行。更多详情请参阅 [回调文档](#)。
- **幂等性保证**: 在恢复过程中，`Step` 和回调可能会被多次执行，因此必须确保它们的幂等性。为避免重复执行，可以在回调中调用 `Exclude(Recovering)`，跳过恢复时的回放。但建议始终保证回调的幂等性，以确保任务恢复时的行为与最初执行时一致。

#### 资源恢复

任务执行和恢复过程中，资源通过 `Suspend` 和 `Recover` 方法管理状态。有关资源管理的更多信息，请参阅 [资源文档](#)。

#### 持久化与敏感数据处理

框架提供灵活的持久化接口，允许用户自定义 `Context` 和 `Resource` 的保存与加载方式，并选择适合的数据库或存储方案。

对于敏感数据，建议在 `Suspend` 时清空这些数据，并在 `Recover` 时重新生成，以避免将敏感信息直接存储到数据库中。如果无法通过资源管理器处理敏感数据，可以使用 Light-Flow 的加密功能。框架默认使用 AES-256 加密 `password` 和 `pwd` 键值，用户可以扩展加密范围并自定义加密算法。

#### 多次恢复

如果任务恢复失败，框架会再次挂起任务，等待下一个恢复机会。这一机制确保任务不会因为一次恢复失败而永久中断。